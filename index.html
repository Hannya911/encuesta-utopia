case 'multiple':
    return (
        <div className="space-y-4">
            {voiceProcessed && (
                <div className="auto-advance-notice p-3 rounded-lg mb-2 text-center">
                    <p className="text-green-700 font-medium text-sm">
                        ‚úÖ Respuesta reconocida: "{selectedOption}". Avanzando autom√°ticamente...
                    </p>
                </div>
            )}
            <div className={`grid ${isMobile ? 'grid-cols-1 gap-3' : 'grid-cols-2 gap-4'} mobile-grid`}>
                {question.options.map((option, index) => (
                    <button
                        key={index}
                        onClick={() => {
                            handleAnswer(question.id, option);
                            setSelectedOption(option);
                            setVoiceProcessed(true);
                            
                            setTimeout(() => {
                                speakText(`Has seleccionado: ${option}`);
                            }, 300);
                            
                            const timer = setTimeout(() => {
                                nextQuestion();
                            }, 2000);
                            setAutoAdvanceTimer(timer);
                            setAutoAdvance(true);
                            setTimeout(() => setAutoAdvance(false), 2000);
                        }}
                        className={`p-4 text-lg border-4 rounded-xl transition-all transform hover:scale-105 mobile-button ${
                            selectedOption === option || currentAnswer === option
                                ? 'option-selected border-green-500 bg-green-100 text-green-800 font-bold'
                                : 'border-blue-300 bg-white hover:border-blue-500 hover:bg-blue-50'
                        } ${autoAdvance && selectedOption === option ? 'auto-advance' : ''}`}
                    >
                        {option}
                    </button>
                ))}
            </div>
            <div className="text-center space-y-2">
                {showPermissionHint && (
                    <div className="permission-warning p-3 rounded-lg mb-2">
                        <p className="text-amber-800 font-medium text-sm">
                            üîí Para usar el micr√≥fono, primero debes permitir el acceso
                        </p>
                        <button
                            onClick={requestMicrophonePermission}
                            className="mt-2 bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-full font-medium transition-colors text-sm"
                        >
                            üé§ Permitir Micr√≥fono
                        </button>
                    </div>
                )}
                <button
                    onClick={startListeningWithPermission}
                    disabled={isListening}
                    className={`px-6 py-3 rounded-full font-medium text-white transition-all transform hover:scale-105 mobile-button mobile-voice-btn ${
                        isListening 
                        ? 'voice-recording' 
                        : hasMicrophoneAccess ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 hover:bg-gray-500'
                    }`}
                >
                    {isListening ? 'üõë Grabando...' : hasMicrophoneAccess ? 'üé§ Responder con voz' : 'üé§ Solicitar Micr√≥fono'}
                </button>
                {voiceAnswer && (
                    <div className={`p-3 rounded-lg text-center ${voiceProcessed ? 'voice-answer-processed' : 'bg-blue-100'}`}>
                        <p className="text-green-600 font-medium text-sm speech-feedback">
                            ‚úÖ Reconocido: "{voiceAnswer}"
                        </p>
                        {voiceProcessed && (
                            <p className="text-blue-600 text-xs mt-1">
                                ‚úÖ Respuesta procesada correctamente
                            </p>
                        )}
                    </div>
                )}
                {voiceError && (
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
                        <p className="text-sm">{voiceError}</p>
                    </div>
                )}
            </div>
        </div>
    );

case 'yesno':
    return (
        <div className="space-y-4">
            {voiceProcessed && (
                <div className="auto-advance-notice p-3 rounded-lg mb-2 text-center">
                    <p className="text-green-700 font-medium text-sm">
                        ‚úÖ Respuesta reconocida: "{selectedOption}". Avanzando autom√°ticamente...
                    </p>
                </div>
            )}
            <div className="grid grid-cols-2 gap-4 mobile-grid">
                {['S√≠', 'No'].map((option) => (
                    <button
                        key={option}
                        onClick={() => {
                            handleAnswer(question.id, option);
                            setSelectedOption(option);
                            setVoiceProcessed(true);
                            
                            setTimeout(() => {
                                speakText(`Has respondido: ${option}`);
                            }, 300);
                            
                            const timer = setTimeout(() => {
                                nextQuestion();
                            }, 2000);
                            setAutoAdvanceTimer(timer);
                            setAutoAdvance(true);
                            setTimeout(() => setAutoAdvance(false), 2000);
                        }}
                        className={`p-6 text-xl border-4 rounded-xl transition-all transform hover:scale-105 mobile-button ${
                            selectedOption === option || currentAnswer === option
                                ? 'option-selected border-green-500 bg-green-100 text-green-800 font-bold'
                                : 'border-blue-300 bg-white hover:border-blue-500 hover:bg-blue-50'
                        } ${autoAdvance && selectedOption === option ? 'auto-advance' : ''}`}
                    >
                        {option} {option === 'S√≠' ? '‚úÖ' : '‚ùå'}
                    </button>
                ))}
            </div>
            <div className="text-center space-y-2">
                {showPermissionHint && (
                    <div className="permission-warning p-3 rounded-lg mb-2">
                        <p className="text-amber-800 font-medium text-sm">
                            üîí Para usar el micr√≥fono, primero debes permitir el acceso
                        </p>
                        <button
                            onClick={requestMicrophonePermission}
                            className="mt-2 bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-full font-medium transition-colors text-sm"
                        >
                            üé§ Permitir Micr√≥fono
                        </button>
                    </div>
                )}
                <button
                    onClick={startListeningWithPermission}
                    disabled={isListening}
                    className={`px-6 py-3 rounded-full font-medium text-white transition-all transform hover:scale-105 mobile-button mobile-voice-btn ${
                        isListening 
                        ? 'voice-recording' 
                        : hasMicrophoneAccess ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 hover:bg-gray-500'
                    }`}
                >
                    {isListening ? 'üõë Grabando...' : hasMicrophoneAccess ? 'üé§ Responder con voz' : 'üé§ Solicitar Micr√≥fono'}
                </button>
                {voiceAnswer && (
                    <div className={`p-3 rounded-lg text-center ${voiceProcessed ? 'voice-answer-processed' : 'bg-blue-100'}`}>
                        <p className="text-green-600 font-medium text-sm speech-feedback">
                            ‚úÖ Reconocido: "{voiceAnswer}"
                        </p>
                        {voiceProcessed && (
                            <p className="text-blue-600 text-xs mt-1">
                                ‚úÖ Respuesta procesada correctamente
                            </p>
                        )}
                    </div>
                )}
                {voiceError && (
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
                        <p className="text-sm">{voiceError}</p>
                    </div>
                )}
            </div>
        </div>
    );

default:
    return null;
}
};

const renderProgress = () => {
const progress = ((currentQuestion + 1) / survey.questions.length) * 100;

return (
    <div className="mb-6">
        <div className="flex justify-between items-center mb-2">
            <span className="text-sm font-medium text-gray-700">
                Pregunta {currentQuestion + 1} de {survey.questions.length}
            </span>
            <span className="text-sm font-medium text-gray-700">
                {Math.round(progress)}%
            </span>
        </div>
        <div className="w-full bg-gray-200 rounded-full h-4">
            <div 
                className="bg-blue-500 h-4 rounded-full transition-all duration-500 ease-out"
                style={{ width: `${progress}%` }}
            ></div>
        </div>
    </div>
);
};

const renderResults = () => {
if (savedSurveys.length === 0) {
    return (
        <div className="text-center p-8">
            <p className="text-xl text-gray-600">No hay respuestas guardadas a√∫n.</p>
        </div>
    );
}

return (
    <div className="space-y-6">
        <div className="flex justify-between items-center">
            <h2 className="text-2xl font-bold text-gray-800">
                Respuestas Guardadas ({savedSurveys.length})
            </h2>
            <button
                onClick={exportToExcel}
                className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full font-medium transition-colors mobile-button"
            >
                üìä Exportar a Excel
            </button>
        </div>
        
        <div className="grid gap-4">
            {savedSurveys.map((surveyData, index) => (
                <div key={surveyData.id} className="bg-white border-2 border-blue-200 rounded-xl p-6">
                    <div className="flex justify-between items-start mb-4">
                        <h3 className="text-lg font-bold text-gray-800">
                            Encuesta #{index + 1}
                        </h3>
                        <span className="text-sm text-gray-500">{surveyData.date}</span>
                    </div>
                    
                    <div className="space-y-2">
                        {survey.questions.map((question) => (
                            <div key={question.id} className="border-b border-gray-100 pb-2">
                                <p className="font-medium text-gray-700 text-sm">
                                    {question.emoji} {question.text}
                                </p>
                                <p className="text-blue-600 font-medium">
                                    {surveyData.answers[question.id] || 'No respondida'}
                                </p>
                            </div>
                        ))}
                    </div>
                </div>
            ))}
        </div>
        
        <div className="text-center space-x-4">
            <button
                onClick={restartSurvey}
                className="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-medium transition-colors mobile-button"
            >
                üÜï Nueva Encuesta
            </button>
            <button
                onClick={() => setShowResults(false)}
                className="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-full font-medium transition-colors mobile-button"
            >
                ‚Üê Volver
            </button>
        </div>
    </div>
);
};

if (showResults) {
return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 py-8 px-4 mobile-padding">
        <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-3xl shadow-xl p-6 md:p-8">
                {renderResults()}
            </div>
        </div>
    </div>
);
}

if (surveyComplete) {
return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center py-8 px-4 mobile-padding">
        <div className="max-w-md w-full">
            <div className="bg-white rounded-3xl shadow-xl p-8 text-center">
                <div className="text-6xl mb-4">üéâ</div>
                <h1 className="text-3xl font-bold text-gray-800 mb-4 mobile-text">
                    ¬°Encuesta Completada!
                </h1>
                <p className="text-lg text-gray-600 mb-6">
                    Gracias por participar en la Encuesta Educaci√≥n Utop√≠a. Tu opini√≥n es muy importante para nosotros.
                </p>
                
                <div className="space-y-4">
                    <button
                        onClick={restartSurvey}
                        className="w-full bg-blue-500 hover:bg-blue-600 text-white py-4 rounded-xl font-medium text-lg transition-colors mobile-button"
                    >
                        üÜï Hacer Otra Encuesta
                    </button>
                    
                    <button
                        onClick={() => setShowResults(true)}
                        className="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-medium text-lg transition-colors mobile-button"
                    >
                        üìä Ver Respuestas
                    </button>
                    
                    {savedSurveys.length > 0 && (
                        <button
                            onClick={exportToExcel}
                            className="w-full bg-purple-500 hover:bg-purple-600 text-white py-4 rounded-xl font-medium text-lg transition-colors mobile-button"
                        >
                            üì• Exportar a Excel
                        </button>
                    )}
                </div>
            </div>
        </div>
    </div>
);
}

return (
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 py-8 px-4 mobile-padding">
    <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-3xl shadow-xl p-6 md:p-8">
            {/* Header */}
            <div className="text-center mb-8">
                <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-2 mobile-text">
                    {survey.title}
                </h1>
                <p className="text-gray-600 text-lg">
                    Pregunta {currentQuestion + 1} de {survey.questions.length}
                </p>
            </div>

            {/* Progress Bar */}
            {renderProgress()}

            {/* Question */}
            <div className="mb-8">
                <div className="flex items-center gap-3 mb-4">
                    <span className="text-3xl">{survey.questions[currentQuestion].emoji}</span>
                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mobile-text">
                        {survey.questions[currentQuestion].text}
                    </h2>
                </div>

                {/* Speech Controls */}
                <div className="flex flex-wrap gap-2 mb-6 mobile-voice-container">
                    <button
                        onClick={toggleSpeech}
                        className={`px-4 py-2 rounded-full font-medium transition-colors mobile-button ${
                            speechEnabled 
                            ? 'bg-green-500 hover:bg-green-600 text-white' 
                            : 'bg-gray-300 hover:bg-gray-400 text-gray-700'
                        }`}
                    >
                        {speechEnabled ? 'üîä Sonido Activado' : 'üîá Sonido Desactivado'}
                    </button>
                    
                    {isReading && (
                        <button
                            onClick={stopSpeaking}
                            className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full font-medium transition-colors mobile-button"
                        >
                            ‚èπÔ∏è Parar
                        </button>
                    )}
                </div>

                {/* Question Content */}
                {renderQuestion()}
            </div>

            {/* Navigation */}
            <div className="flex justify-between items-center pt-6 border-t border-gray-200">
                <button
                    onClick={prevQuestion}
                    disabled={currentQuestion === 0}
                    className={`px-6 py-3 rounded-full font-medium transition-colors mobile-button ${
                        currentQuestion === 0
                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                        : 'bg-gray-500 hover:bg-gray-600 text-white'
                    }`}
                >
                    ‚Üê Anterior
                </button>

                <div className="text-center">
                    {currentQuestion === survey.questions.length - 1 ? (
                        <button
                            onClick={completeSurvey}
                            className="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-medium transition-colors mobile-button"
                        >
                            ‚úÖ Finalizar
                        </button>
                    ) : (
                        <button
                            onClick={nextQuestion}
                            className="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-medium transition-colors mobile-button"
                        >
                            Siguiente ‚Üí
                        </button>
                    )}
                </div>

                <button
                    onClick={() => setShowResults(true)}
                    className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-full font-medium transition-colors mobile-button"
                >
                    üìä Resultados
                </button>
            </div>
        </div>
    </div>
</div>
);
}

// Render the app
ReactDOM.render(<KidsInteractiveSurvey />, document.getElementById('app'));